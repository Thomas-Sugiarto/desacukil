<!-- Modal Components -->

<!-- Confirmation Modal -->
{% macro confirmation_modal(id='confirmModal', title='Konfirmasi', message='Apakah Anda yakin?', confirm_text='Ya', cancel_text='Batal', confirm_class='btn-danger') %}
<div class="modal fade" id="{{ id }}" tabindex="-1" aria-labelledby="{{ id }}Label" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="{{ id }}Label">
                    <i class="bi bi-question-circle me-2"></i>{{ title }}
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="mb-0">{{ message }}</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ cancel_text }}</button>
                <button type="button" class="btn {{ confirm_class }}" id="{{ id }}Confirm">{{ confirm_text }}</button>
            </div>
        </div>
    </div>
</div>
{% endmacro %}

<!-- Delete Confirmation Modal -->
{% macro delete_modal(id='deleteModal', title='Hapus Data', item_name='item ini') %}
<div class="modal fade" id="{{ id }}" tabindex="-1" aria-labelledby="{{ id }}Label" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="{{ id }}Label">
                    <i class="bi bi-trash me-2"></i>{{ title }}
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="d-flex align-items-center mb-3">
                    <i class="bi bi-exclamation-triangle-fill text-warning fs-1 me-3"></i>
                    <div>
                        <h6 class="mb-1">Peringatan!</h6>
                        <p class="mb-0">Apakah Anda yakin ingin menghapus <strong>{{ item_name }}</strong>?</p>
                        <small class="text-muted">Tindakan ini tidak dapat dibatalkan.</small>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle me-1"></i>Batal
                </button>
                <button type="button" class="btn btn-danger" id="{{ id }}Confirm">
                    <i class="bi bi-trash me-1"></i>Ya, Hapus
                </button>
            </div>
        </div>
    </div>
</div>
{% endmacro %}

<!-- Loading Modal -->
{% macro loading_modal(id='loadingModal', title='Memproses', message='Mohon tunggu...') %}
<div class="modal fade" id="{{ id }}" tabindex="-1" aria-labelledby="{{ id }}Label" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-sm modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body text-center py-4">
                <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <h6 class="mb-2">{{ title }}</h6>
                <p class="text-muted mb-0">{{ message }}</p>
            </div>
        </div>
    </div>
</div>
{% endmacro %}

<!-- Image Preview Modal -->
{% macro image_preview_modal(id='imageModal') %}
<div class="modal fade" id="{{ id }}" tabindex="-1" aria-labelledby="{{ id }}Label" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="{{ id }}Label">Preview Gambar</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <img id="{{ id }}Image" src="" class="img-fluid" alt="Preview">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
            </div>
        </div>
    </div>
</div>
{% endmacro %}

<!-- Content Preview Modal -->
{% macro content_preview_modal(id='contentPreviewModal') %}
<div class="modal fade" id="{{ id }}" tabindex="-1" aria-labelledby="{{ id }}Label" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="{{ id }}Label">
                    <i class="bi bi-eye me-2"></i>Preview Konten
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="{{ id }}Content">
                    <!-- Content will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                <button type="button" class="btn btn-primary" id="{{ id }}Edit">
                    <i class="bi bi-pencil me-1"></i>Edit
                </button>
            </div>
        </div>
    </div>
</div>
{% endmacro %}

<!-- Form Modal -->
{% macro form_modal(id='formModal', title='Form', size='modal-lg', form_action='', method='POST') %}
<div class="modal fade" id="{{ id }}" tabindex="-1" aria-labelledby="{{ id }}Label" aria-hidden="true">
    <div class="modal-dialog {{ size }}">
        <div class="modal-content">
            <form action="{{ form_action }}" method="{{ method }}" id="{{ id }}Form">
                <div class="modal-header">
                    <h5 class="modal-title" id="{{ id }}Label">{{ title }}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="{{ id }}Body">
                        <!-- Form content will be loaded here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-check-lg me-1"></i>Simpan
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endmacro %}

<!-- User Profile Modal -->
{% macro user_profile_modal(id='userProfileModal') %}
<div class="modal fade" id="{{ id }}" tabindex="-1" aria-labelledby="{{ id }}Label" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="{{ id }}Label">
                    <i class="bi bi-person-circle me-2"></i>Profil User
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="text-center mb-3">
                    <img id="{{ id }}Avatar" src="{{ url_for('static', filename='images/default-avatar.png') }}" 
                         class="rounded-circle mb-2" width="80" height="80" alt="Avatar">
                    <h6 id="{{ id }}Name" class="mb-1">Nama User</h6>
                    <span id="{{ id }}Role" class="badge bg-primary">Role</span>
                </div>
                <div class="row">
                    <div class="col-sm-4"><strong>Email:</strong></div>
                    <div class="col-sm-8" id="{{ id }}Email">-</div>
                </div>
                <div class="row mt-2">
                    <div class="col-sm-4"><strong>Telepon:</strong></div>
                    <div class="col-sm-8" id="{{ id }}Phone">-</div>
                </div>
                <div class="row mt-2">
                    <div class="col-sm-4"><strong>Status:</strong></div>
                    <div class="col-sm-8" id="{{ id }}Status">-</div>
                </div>
                <div class="row mt-2">
                    <div class="col-sm-4"><strong>Bergabung:</strong></div>
                    <div class="col-sm-8" id="{{ id }}JoinDate">-</div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                <button type="button" class="btn btn-primary" id="{{ id }}Edit">
                    <i class="bi bi-pencil me-1"></i>Edit
                </button>
            </div>
        </div>
    </div>
</div>
{% endmacro %}

<!-- Bulk Action Modal -->
{% macro bulk_action_modal(id='bulkActionModal') %}
<div class="modal fade" id="{{ id }}" tabindex="-1" aria-labelledby="{{ id }}Label" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="{{ id }}Label">
                    <i class="bi bi-list-check me-2"></i>Aksi Massal
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Pilih aksi yang ingin dilakukan pada <span id="{{ id }}Count">0</span> item yang dipilih:</p>
                <div class="list-group">
                    <button type="button" class="list-group-item list-group-item-action" data-action="publish">
                        <i class="bi bi-check-circle me-2 text-success"></i>Publikasikan
                    </button>
                    <button type="button" class="list-group-item list-group-item-action" data-action="unpublish">
                        <i class="bi bi-pause-circle me-2 text-warning"></i>Batalkan Publikasi
                    </button>
                    <button type="button" class="list-group-item list-group-item-action" data-action="delete">
                        <i class="bi bi-trash me-2 text-danger"></i>Hapus
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
            </div>
        </div>
    </div>
</div>
{% endmacro %}

<!-- JavaScript for Modal Functions -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Confirmation modal handler
    window.showConfirmModal = function(title, message, onConfirm, confirmText = 'Ya', cancelText = 'Batal') {
        const modalId = 'dynamicConfirmModal';
        let modal = document.getElementById(modalId);
        
        if (!modal) {
            const modalHtml = `
                <div class="modal fade" id="${modalId}" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">
                                    <i class="bi bi-question-circle me-2"></i><span id="${modalId}Title"></span>
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <p id="${modalId}Message"></p>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="${modalId}Cancel"></button>
                                <button type="button" class="btn btn-danger" id="${modalId}Confirm"></button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            modal = document.getElementById(modalId);
        }
        
        document.getElementById(modalId + 'Title').textContent = title;
        document.getElementById(modalId + 'Message').textContent = message;
        document.getElementById(modalId + 'Confirm').textContent = confirmText;
        document.getElementById(modalId + 'Cancel').textContent = cancelText;
        
        const confirmBtn = document.getElementById(modalId + 'Confirm');
        const newConfirmBtn = confirmBtn.cloneNode(true);
        confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);
        
        newConfirmBtn.addEventListener('click', function() {
            bootstrap.Modal.getInstance(modal).hide();
            if (onConfirm) onConfirm();
        });
        
        const bsModal = new bootstrap.Modal(modal);
        bsModal.show();
    };
    
    // Loading modal handler
    window.showLoadingModal = function(title = 'Memproses', message = 'Mohon tunggu...') {
        const modalId = 'dynamicLoadingModal';
        let modal = document.getElementById(modalId);
        
        if (!modal) {
            const modalHtml = `
                <div class="modal fade" id="${modalId}" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
                    <div class="modal-dialog modal-sm modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-body text-center py-4">
                                <div class="spinner-border text-primary mb-3" style="width: 3rem; height: 3rem;">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <h6 class="mb-2" id="${modalId}Title"></h6>
                                <p class="text-muted mb-0" id="${modalId}Message"></p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            modal = document.getElementById(modalId);
        }
        
        document.getElementById(modalId + 'Title').textContent = title;
        document.getElementById(modalId + 'Message').textContent = message;
        
        const bsModal = new bootstrap.Modal(modal);
        bsModal.show();
        
        return bsModal;
    };
    
    // Hide loading modal
    window.hideLoadingModal = function() {
        const modal = document.getElementById('dynamicLoadingModal');
        if (modal) {
            const bsModal = bootstrap.Modal.getInstance(modal);
            if (bsModal) bsModal.hide();
        }
    };
    
    // Image preview handler
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('preview-image')) {
            e.preventDefault();
            const imgSrc = e.target.src || e.target.dataset.src;
            const modal = document.getElementById('imageModal');
            if (modal) {
                document.getElementById('imageModalImage').src = imgSrc;
                new bootstrap.Modal(modal).show();
            }
        }
    });
});
</script>