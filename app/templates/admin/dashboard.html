{% extends "base/dashboard.html" %}

{% block title %}Admin Dashboard - {{ site_settings.site_name or 'Portal Desa Digital' }}{% endblock %}

{% block sidebar %}
<ul class="nav flex-column">
    <li class="nav-item">
        <a class="nav-link active" href="{{ url_for('admin.dashboard') }}">
            <i class="bi bi-speedometer2"></i>
            Dashboard
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{{ url_for('admin.users') }}">
            <i class="bi bi-people"></i>
            Kelola User
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{{ url_for('admin.content_list') }}">
            <i class="bi bi-file-earmark-text"></i>
            Kelola Konten
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{{ url_for('admin.categories') }}">
            <i class="bi bi-tags"></i>
            Kategori
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{{ url_for('admin.settings') }}">
            <i class="bi bi-gear"></i>
            Pengaturan
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{{ url_for('admin.audit_logs') }}">
            <i class="bi bi-clock-history"></i>
            Log Audit
        </a>
    </li>
</ul>
{% endblock %}

{% block page_title %}Dashboard Admin{% endblock %}

{% block page_actions %}
<a href="{{ url_for('auth.register') }}" class="btn btn-primary">
    <i class="bi bi-person-plus me-1"></i>
    Tambah User
</a>
{% endblock %}

{% block content %}
<!-- Statistics Cards -->
<div class="row mb-4">
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="dashboard-card card border-left-primary">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Total User</div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{ stats.total_users }}</div>
                    </div>
                    <div class="col-auto">
                        <i class="bi bi-people display-6 text-primary"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="dashboard-card card border-left-success">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Konten Dipublikasi</div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{ stats.published_content }}</div>
                    </div>
                    <div class="col-auto">
                        <i class="bi bi-check-circle display-6 text-success"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="dashboard-card card border-left-warning">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">Menunggu Review</div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{ stats.pending_content }}</div>
                    </div>
                    <div class="col-auto">
                        <i class="bi bi-clock display-6 text-warning"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="dashboard-card card border-left-info">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-info text-uppercase mb-1">Total Konten</div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{ stats.total_content }}</div>
                    </div>
                    <div class="col-auto">
                        <i class="bi bi-file-earmark-text display-6 text-info"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Recent Content -->
    <div class="col-lg-6 mb-4">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h6 class="m-0 font-weight-bold">Konten Terbaru</h6>
            </div>
            <div class="card-body">
                {% if recent_content %}
                <div class="list-group list-group-flush">
                    {% for content in recent_content %}
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="mb-1">{{ content.title|truncate(50) }}</h6>
                            <small class="text-muted">
                                oleh {{ content.author.full_name }} • {{ content.created_at|timeago }}
                            </small>
                        </div>
                        <span class="badge bg-{{ content.status|status_badge }}">
                            {{ content.status|status_text }}
                        </span>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted text-center">Belum ada konten.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Recent Users -->
    <div class="col-lg-6 mb-4">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h6 class="m-0 font-weight-bold">User Terbaru</h6>
            </div>
            <div class="card-body">
                {% if recent_users %}
                <div class="list-group list-group-flush">
                    {% for user in recent_users %}
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="mb-1">{{ user.full_name }}</h6>
                            <small class="text-muted">
                                @{{ user.username }} • {{ user.role.name.title() }}
                            </small>
                        </div>
                        <span class="badge bg-{{ user.status|status_badge }}">
                            {{ user.status|status_text }}
                        </span>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted text-center">Belum ada user baru.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Content by Category Chart -->
<div class="row">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-header bg-info text-white">
                <h6 class="m-0 font-weight-bold">Konten per Kategori</h6>
            </div>
            <div class="card-body">
                <canvas id="categoryChart" width="100" height="40"></canvas>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Chart for content by category
var ctx = document.getElementById('categoryChart').getContext('2d');
var categoryChart = new Chart(ctx, {
    type: 'doughnut',
    data: {
        labels: [
            {% for category, count in content_by_category %}
            '{{ category }}'{% if not loop.last %},{% endif %}
            {% endfor %}
        ],
        datasets: [{
            data: [
                {% for category, count in content_by_category %}
                {{ count }}{% if not loop.last %},{% endif %}
                {% endfor %}
            ],
            backgroundColor: [
                '#28a745',
                '#007bff',
                '#ffc107',
                '#17a2b8',
                '#6f42c1',
                '#e83e8c'
            ]
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'bottom'
            }
        }
    }
});
</script>
{% endblock %}